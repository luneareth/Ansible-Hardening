---
- name: Install AIDE on Packages
  package:
      name: aide
      state: present
  when: ansible_os_family == 'CentOS' or ansible_os_family == 'RedHat' or ansible_distribution == 'CentOS' or ansible_os_family == 'Debian' or ansible_os_family == 'Ubuntu' or ansible_distribution == 'Ubuntu'
  tags: 
    - iam-file_integrity
    - file_integrity-install_aide
    - install_aide-packages


- name: "[RPM] Iniziate Database Aide RPM Based"
  shell: aide --init
  when: ansible_os_family == 'CentOS' or ansible_os_family == 'RedHat' or ansible_distribution == 'CentOS'
  tags: 
    - iam-file_integrity
    - file_integrity-init_rpm
   

- name: "[DEB] Iniziate Database Aide DEB Based"
  shell: aideinit
  when: ansible_os_family == 'Debian' or ansible_os_family == 'Ubuntu' or ansible_distribution == 'Ubuntu'
  tags: 
    - iam-file_integrity
    - file_integrity-init_deb
    

- name: "[RPM Based] Copy Database to Lib"
  copy: 
      src: /var/lib/aide/aide.db.new.gz
      dest: /var/lib/aide/aide.db.gz
      remote_src: true
  when: ansible_os_family == 'CentOS' or ansible_os_family == 'RedHat' or ansible_distribution == 'CentOS'
  tags: 
    - iam-file_integrity
    - file_integrity-copy_db_results
   

- name: Init Configuration Debian
  shell: /usr/sbin/update-aide.conf
  when: ansible_distribution == 'Debian' 
  tags:
     - iam-file_integrity
     - file_integrity-generate_config_aide
    

- name: Copy Configuration Init Debian
  copy:
    src: /var/lib/aide/aide.conf.autogenerated
    dest: /etc/aide/aide.conf
    remote_src: true
  when: ansible_os_family == 'Debian' or ansible_os_family == 'Ubuntu' or ansible_distribution == 'Ubuntu'
  tags:
    - iam-file_integrity
    - file_integrity-copy_config_aide

